# æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯ - ä½¿ç”¨è¯´æ˜

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿéƒ¨ç½²](#ç³»ç»Ÿéƒ¨ç½²)
2. [æ•°æ®åº“é…ç½®](#æ•°æ®åº“é…ç½®)
3. [API æœåŠ¡å™¨é…ç½®](#apiæœåŠ¡å™¨é…ç½®)
4. [å®¢æˆ·ç«¯ä½¿ç”¨](#å®¢æˆ·ç«¯ä½¿ç”¨)
5. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸš€ ç³»ç»Ÿéƒ¨ç½²

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
pip install pymysql flask
```

### 2. æ–‡ä»¶è¯´æ˜

- `database_schema.sql` - æ•°æ®åº“è¡¨ç»“æ„
- `api_server.py` - API æœåŠ¡ç«¯ï¼ˆæœåŠ¡å™¨è¿è¡Œï¼‰
- `ui_client.py` - åˆ·é‡å®¢æˆ·ç«¯ï¼ˆå·¥äººç”µè„‘è¿è¡Œï¼‰
- `to_requests.py` - åˆ·é‡æ ¸å¿ƒé€»è¾‘ï¼ˆä¸è¦ä¿®æ”¹ï¼‰

---

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### 1. åˆ›å»ºæ•°æ®åº“

```sql
CREATE DATABASE tb_live DEFAULT CHARSET=utf8mb4;
USE tb_live;
```

### 2. å¯¼å…¥è¡¨ç»“æ„

```bash
mysql -u root -p tb_live < database_schema.sql
```

### 3. è¡¨è¯´æ˜

#### `tb_clients` - å®¢æˆ·ç«¯é…ç½®è¡¨

- æ¯å°ç”µè„‘å¯¹åº”ä¸€ä¸ª `client_key`
- ç¤ºä¾‹å·²è‡ªåŠ¨åˆ›å»º 10 ä¸ªå®¢æˆ·ç«¯å¯†é’¥ï¼š`client_key_001` åˆ° `client_key_010`

#### `tb_cookies` - Cookie è´¦å·è¡¨

- å­˜å‚¨æ‰€æœ‰ Cookie è´¦å·
- é€šè¿‡ `client_id` åˆ†é…ç»™ä¸åŒå®¢æˆ·ç«¯

#### `tb_devices` - è®¾å¤‡å‚æ•°è¡¨

- å­˜å‚¨æ‰€æœ‰è®¾å¤‡å‚æ•°
- é€šè¿‡ `client_id` åˆ†é…ç»™ä¸åŒå®¢æˆ·ç«¯

### 4. åˆ†é…æ•°æ®ç¤ºä¾‹

```sql
-- ç»™ç”µè„‘1åˆ†é…100ä¸ªCookie
UPDATE tb_cookies SET client_id = 1 WHERE id <= 100 AND client_id IS NULL;

-- ç»™ç”µè„‘1åˆ†é…100ä¸ªè®¾å¤‡
UPDATE tb_devices SET client_id = 1 WHERE id <= 100 AND client_id IS NULL;

-- ç»™ç”µè„‘2åˆ†é…100ä¸ªCookie
UPDATE tb_cookies SET client_id = 2 WHERE id > 100 AND id <= 200 AND client_id IS NULL;

-- ç»™ç”µè„‘2åˆ†é…100ä¸ªè®¾å¤‡
UPDATE tb_devices SET client_id = 2 WHERE id > 100 AND id <= 200 AND client_id IS NULL;
```

---

## ğŸŒ API æœåŠ¡å™¨é…ç½®

### 1. ä¿®æ”¹æ•°æ®åº“é…ç½®

ç¼–è¾‘ `api_server.py`ï¼Œä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š

```python
DB_CONFIG = {
    'host': 'localhost',      # æ•°æ®åº“åœ°å€
    'port': 3306,              # æ•°æ®åº“ç«¯å£
    'user': 'root',            # æ•°æ®åº“ç”¨æˆ·å
    'password': 'your_password',  # ä¿®æ”¹ä¸ºä½ çš„å¯†ç 
    'database': 'tb_live',     # æ•°æ®åº“å
    'charset': 'utf8mb4'
}
```

### 2. å¯åŠ¨ API æœåŠ¡

```bash
python api_server.py
```

æœåŠ¡å°†ç›‘å¬åœ¨ `0.0.0.0:5000`

### 3. API æ¥å£è¯´æ˜

#### å¥åº·æ£€æŸ¥

```
GET /api/ping
```

#### è·å– Cookie

```
POST /api/fetch_cookies
{
  "client_key": "client_key_001",
  "limit": 100
}
```

#### è·å–è®¾å¤‡å‚æ•°

```
POST /api/fetch_devices
{
  "client_key": "client_key_001",
  "limit": 100
}
```

---

## ğŸ’» å®¢æˆ·ç«¯ä½¿ç”¨

### 1. å¯åŠ¨å®¢æˆ·ç«¯

åŒå‡»è¿è¡Œï¼š`å¯åŠ¨_åˆ·é‡å®¢æˆ·ç«¯.bat`

æˆ–å‘½ä»¤è¡Œï¼š

```bash
python ui_client.py
```

### 2. é…ç½®æ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šé…ç½® API

1. ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **"é…ç½®ç®¡ç†"**
2. å¡«å†™ **API åœ°å€**ï¼ˆé»˜è®¤ï¼š`http://localhost:5000`ï¼‰
3. å¡«å†™ **å®¢æˆ·ç«¯å¯†é’¥**ï¼ˆä¾‹å¦‚ï¼š`client_key_001`ï¼‰
4. ç‚¹å‡» **"ä¿å­˜"**

#### ç¬¬äºŒæ­¥ï¼šè·å– Cookie

ä¸‰ç§æ–¹å¼ä»»é€‰å…¶ä¸€ï¼š

1. **æ‰‹åŠ¨è¾“å…¥**ï¼šç‚¹å‡»"æ‰‹åŠ¨è¾“å…¥"ï¼Œç²˜è´´ Cookieï¼Œæ¯è¡Œä¸€ä¸ª
2. **ä»æ–‡ä»¶å¯¼å…¥**ï¼šç‚¹å‡»"ä»æ–‡ä»¶å¯¼å…¥"ï¼Œé€‰æ‹© Cookie æ–‡ä»¶ï¼ˆtxt æ ¼å¼ï¼‰
3. **è¿œç¨‹æ‹‰å–**ï¼šç‚¹å‡»"è¿œç¨‹æ‹‰å–"ï¼Œä»æ•°æ®åº“è‡ªåŠ¨è·å–ï¼ˆæ¨èï¼‰

#### ç¬¬ä¸‰æ­¥ï¼šè·å–è®¾å¤‡å‚æ•°

ä¸¤ç§æ–¹å¼ä»»é€‰å…¶ä¸€ï¼š

1. **ä»æ–‡ä»¶å¯¼å…¥**ï¼šç‚¹å‡»"ä»æ–‡ä»¶å¯¼å…¥"ï¼Œé€‰æ‹©è®¾å¤‡æ–‡ä»¶ï¼ˆtxt æ ¼å¼ï¼‰
2. **è¿œç¨‹æ‹‰å–**ï¼šç‚¹å‡»"è¿œç¨‹æ‹‰å–"ï¼Œä»æ•°æ®åº“è‡ªåŠ¨è·å–ï¼ˆæ¨èï¼‰

### 3. åˆ·é‡æ“ä½œ

#### æ“ä½œæµç¨‹

1. **è¾“å…¥æ·˜å£ä»¤**

   - ç²˜è´´ç›´æ’­é—´çš„æ·˜å£ä»¤åˆ°è¾“å…¥æ¡†
   - ç‚¹å‡» **"è§£æ"** æŒ‰é’®
   - ç³»ç»Ÿä¼šè‡ªåŠ¨è§£æå‡ºç›´æ’­é—´ ID å’Œå½“å‰è§‚çœ‹æ•°

2. **è·å–æ“ä½œå‰æ•°æ®**

   - ç‚¹å‡» **"è·å–æ“ä½œå‰æ•°æ®"** æŒ‰é’®
   - ç³»ç»Ÿä¼šè®°å½•å½“å‰çš„è§‚çœ‹æ•°ï¼ˆç”¨äºåç»­å¯¹è´¦ï¼‰

3. **é…ç½®å‚æ•°**

   - **æ“ä½œå€æ•°**ï¼šæ¯ä¸ªè´¦å·å’Œè®¾å¤‡çš„æ“ä½œæ¬¡æ•°ï¼ˆé»˜è®¤ 1ï¼‰
   - **ä»£ç†åœ°å€**ï¼šå¯é€‰ï¼Œä¸å¡«åˆ™ä¸ä½¿ç”¨ä»£ç†

4. **å¼€å§‹åˆ·é‡**
   - ç‚¹å‡» **"å¼€å§‹åˆ·é‡"** æŒ‰é’®
   - ç­‰å¾…ä»»åŠ¡å®Œæˆ
   - ç³»ç»Ÿä¼šè‡ªåŠ¨è·å–æ“ä½œåçš„è§‚çœ‹æ•°å¹¶è®¡ç®—å¢é‡

#### ç»“æœæŸ¥çœ‹

ä»»åŠ¡å®Œæˆåï¼Œç•Œé¢ä¼šæ˜¾ç¤ºï¼š

- **æ“ä½œå‰è§‚çœ‹æ•°**ï¼šä»»åŠ¡å¼€å§‹å‰çš„è§‚çœ‹æ•°
- **æ“ä½œåè§‚çœ‹æ•°**ï¼šä»»åŠ¡å®Œæˆåçš„è§‚çœ‹æ•°
- **å¢é‡**ï¼šå®é™…å¢åŠ çš„è§‚çœ‹æ•°ï¼ˆç”¨äºå¯¹è´¦ï¼‰

---

## ğŸ“Š æ•°æ®å¯¼å…¥æŒ‡å—

### å¯¼å…¥ Cookie åˆ°æ•°æ®åº“

```sql
-- æ–¹æ³•1ï¼šå•æ¡æ’å…¥
INSERT INTO tb_cookies (cookie, uid, status) VALUES
('cookieå†…å®¹1', 'uid1', 1),
('cookieå†…å®¹2', 'uid2', 1);

-- æ–¹æ³•2ï¼šæ‰¹é‡å¯¼å…¥ï¼ˆä»CSVæ–‡ä»¶ï¼‰
LOAD DATA LOCAL INFILE 'cookies.csv'
INTO TABLE tb_cookies
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
(cookie, uid);
```

### å¯¼å…¥è®¾å¤‡åˆ°æ•°æ®åº“

ä» `è®¾å¤‡.txt` æ–‡ä»¶å¯¼å…¥ï¼ˆæ ¼å¼ï¼šdevid\tminiwua\tsgext\tumt\tutdidï¼‰

```python
# å¯¼å…¥è„šæœ¬ç¤ºä¾‹
import pymysql

conn = pymysql.connect(
    host='localhost',
    user='root',
    password='your_password',
    database='tb_live'
)

with open('è®¾å¤‡.txt', 'r', encoding='utf-8') as f:
    for line in f:
        parts = line.strip().split('\t')
        if len(parts) >= 5:
            devid, miniwua, sgext, umt, utdid = parts[0], parts[1], parts[2], parts[3], parts[4]

            cursor = conn.cursor()
            sql = """
                INSERT INTO tb_devices (devid, miniwua, sgext, umt, utdid)
                VALUES (%s, %s, %s, %s, %s)
            """
            cursor.execute(sql, (devid, miniwua, sgext, umt, utdid))
            conn.commit()
            cursor.close()

conn.close()
print("å¯¼å…¥å®Œæˆ")
```

---

## â“ å¸¸è§é—®é¢˜

### 1. æ— æ³•è¿æ¥ API æœåŠ¡å™¨

**åŸå› **ï¼š

- API æœåŠ¡å™¨æœªå¯åŠ¨
- ç½‘ç»œä¸é€š
- é˜²ç«å¢™é˜»æ­¢

**è§£å†³**ï¼š

- ç¡®è®¤ API æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ API åœ°å€é…ç½®æ˜¯å¦æ­£ç¡®
- å…³é—­é˜²ç«å¢™æˆ–æ·»åŠ ç«¯å£ä¾‹å¤–ï¼ˆ5000 ç«¯å£ï¼‰

### 2. æ‹‰å– Cookie/è®¾å¤‡å¤±è´¥

**åŸå› **ï¼š

- å®¢æˆ·ç«¯å¯†é’¥é”™è¯¯
- æ•°æ®åº“ä¸­æ²¡æœ‰åˆ†é…ç»™è¯¥å®¢æˆ·ç«¯çš„æ•°æ®

**è§£å†³**ï¼š

- æ£€æŸ¥å®¢æˆ·ç«¯å¯†é’¥æ˜¯å¦æ­£ç¡®
- åœ¨æ•°æ®åº“ä¸­ç»™è¯¥å®¢æˆ·ç«¯åˆ†é…æ•°æ®ï¼š
  ```sql
  UPDATE tb_cookies SET client_id = 1 WHERE id <= 100;
  UPDATE tb_devices SET client_id = 1 WHERE id <= 100;
  ```

### 3. æ·˜å£ä»¤è§£æå¤±è´¥

**åŸå› **ï¼š

- æ·˜å£ä»¤æ ¼å¼ä¸æ­£ç¡®
- æ·˜å£ä»¤å·²è¿‡æœŸ

**è§£å†³**ï¼š

- é‡æ–°è·å–æœ€æ–°çš„æ·˜å£ä»¤
- ç¡®ä¿æ·˜å£ä»¤å®Œæ•´ï¼ˆåŒ…å«é“¾æ¥ï¼‰

### 4. åˆ·é‡ä»»åŠ¡å¤±è´¥

**åŸå› **ï¼š

- Cookie å¤±æ•ˆ
- è®¾å¤‡å‚æ•°å¤±æ•ˆ
- ç½‘ç»œé—®é¢˜

**è§£å†³**ï¼š

- æ›´æ¢æ–°çš„ Cookie
- æ›´æ¢æ–°çš„è®¾å¤‡å‚æ•°
- æ£€æŸ¥ç½‘ç»œè¿æ¥

---

## ğŸ” å®‰å…¨å»ºè®®

1. **API æœåŠ¡å™¨**ï¼š

   - ä½¿ç”¨ HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
   - å®šæœŸæ›´æ¢å®¢æˆ·ç«¯å¯†é’¥
   - é™åˆ¶ API è®¿é—® IP

2. **æ•°æ®åº“**ï¼š

   - ä½¿ç”¨å¼ºå¯†ç 
   - å®šæœŸå¤‡ä»½æ•°æ®
   - é™åˆ¶å¤–éƒ¨è®¿é—®

3. **å®¢æˆ·ç«¯**ï¼š
   - ä¸è¦åˆ†äº«å®¢æˆ·ç«¯å¯†é’¥
   - å®šæœŸæ¸…ç†æœ¬åœ°é…ç½®æ–‡ä»¶
   - ä½¿ç”¨ä»£ç†ä¿æŠ¤ IP

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-11-01
