# æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯ - æ‰“åŒ…è¯´æ˜æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [æ‰“åŒ…ç¯å¢ƒå‡†å¤‡](#æ‰“åŒ…ç¯å¢ƒå‡†å¤‡)
2. [éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶æ¸…å•](#éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶æ¸…å•)
3. [ä¸éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶](#ä¸éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶)
4. [æ‰“åŒ…æµç¨‹](#æ‰“åŒ…æµç¨‹)
5. [æ‰“åŒ…åç›®å½•ç»“æ„](#æ‰“åŒ…åç›®å½•ç»“æ„)
6. [æµ‹è¯•ä¸åˆ†å‘](#æµ‹è¯•ä¸åˆ†å‘)

---

## ğŸ”§ æ‰“åŒ…ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£… Python æ‰“åŒ…å·¥å…·
pip install pyinstaller

# å®‰è£…æ‰€æœ‰è¿è¡Œæ—¶ä¾èµ–
pip install -r requirements.txt
```

### 2. ä¾èµ–è¯´æ˜

`ui_client.py` çš„æ ¸å¿ƒä¾èµ–ï¼š

**Python æ ‡å‡†åº“ï¼š**

- `os`, `json`, `logging`, `threading`, `re`, `time`, `math`, `datetime`

**ç¬¬ä¸‰æ–¹åº“ï¼š**

- `PyQt5==5.15.9` - UI æ¡†æ¶
- `PyQt-Fluent-Widgets==1.5.6` - Fluent UI ç»„ä»¶
- `requests==2.31.0` - HTTP è¯·æ±‚
- `psutil==5.9.5` - ç³»ç»Ÿè¿›ç¨‹ç®¡ç†ï¼ˆå¯é€‰ï¼Œç”¨äºæ•°æ®åº“è¿‡æ»¤ï¼‰
- `loguru` - æ—¥å¿—ï¼ˆto_requests.py ä½¿ç”¨ï¼‰

**é¡¹ç›®å†…éƒ¨æ¨¡å—ï¼š**

- `to_requests.py` - åˆ·é‡ä»»åŠ¡æ‰§è¡Œ
- `database.py` - æœ¬åœ°æ•°æ®åº“ç¼“å­˜ç®¡ç†
- `tools.py` - Cookie/å·¥å…·å‡½æ•°
- `model/user.py` - User æ¨¡å‹
- `model/device.py` - Device æ¨¡å‹ï¼ˆé€šè¿‡ to_requests é—´æ¥ä½¿ç”¨ï¼‰
- `taobao.py` - æ·˜å® API è°ƒç”¨ï¼ˆé€šè¿‡ to_requests é—´æ¥ä½¿ç”¨ï¼‰
- `proxy_manager.py` - ä»£ç†ç®¡ç†ï¼ˆé€šè¿‡ to_requests é—´æ¥ä½¿ç”¨ï¼‰

---

## âœ… éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒç¨‹åºæ–‡ä»¶

```
ui_client.py                    # ä¸»ç¨‹åºå…¥å£
to_requests.py                  # åˆ·é‡ä»»åŠ¡æ‰§è¡Œé€»è¾‘
database.py                     # æœ¬åœ°æ•°æ®åº“ç¼“å­˜
tools.py                        # Cookie/å·¥å…·å‡½æ•°
taobao.py                       # æ·˜å® API è°ƒç”¨
proxy_manager.py                # ä»£ç†ç®¡ç†
```

### æ¨¡å‹æ–‡ä»¶ï¼ˆmodel ç›®å½•ï¼‰

```
model/
â”œâ”€â”€ __init__.py                 # åŒ…åˆå§‹åŒ–æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
â”œâ”€â”€ user.py                     # User æ¨¡å‹
â””â”€â”€ device.py                   # Device æ¨¡å‹
```

### é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œå¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆï¼‰

```
client_config.json              # å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼ˆé¦–æ¬¡è¿è¡Œä¼šç”Ÿæˆï¼‰
task_timestamps.json            # ä»»åŠ¡æ—¶é—´æˆ³ç¼“å­˜ï¼ˆé¦–æ¬¡è¿è¡Œä¼šç”Ÿæˆï¼‰
used_devices.json               # å·²ä½¿ç”¨è®¾å¤‡è®°å½•ï¼ˆé¦–æ¬¡è¿è¡Œä¼šç”Ÿæˆï¼‰
```

### æ—¥å¿—ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰

```
logs/                           # æ—¥å¿—ç›®å½•ï¼ˆç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ ui_client_YYYY-MM-DD.log   # æ™®é€šæ—¥å¿—
â””â”€â”€ error_YYYY-MM-DD.log        # é”™è¯¯æ—¥å¿—
```

---

## âŒ ä¸éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶æ˜¯**æœåŠ¡å™¨ç«¯**æˆ–**è®¾å¤‡ç”Ÿæˆå·¥å…·**ä½¿ç”¨çš„ï¼Œ**ä¸éœ€è¦**æ‰“åŒ…è¿›å®¢æˆ·ç«¯ï¼š

### æœåŠ¡å™¨ç«¯æ–‡ä»¶

```
api_server.py                   # æœåŠ¡å™¨ç«¯ APIï¼ˆå®¢æˆ·ç«¯ä¸ä¾èµ–ï¼‰
database_schema.sql             # æ•°æ®åº“è¡¨ç»“æ„ï¼ˆæœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼‰
import_data_to_db.py            # æ•°æ®å¯¼å…¥å·¥å…·ï¼ˆæœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼‰
```

### è®¾å¤‡ç”Ÿæˆå·¥å…·æ–‡ä»¶

```
generate_device.py              # è®¾å¤‡ç”Ÿæˆå·¥å…·ï¼ˆå®¢æˆ·ç«¯ä¸ä¾èµ–ï¼‰
device_config.py                # è®¾å¤‡ç”Ÿæˆé…ç½®
device_randomizer.py            # è®¾å¤‡éšæœºåŒ–å·¥å…·
mumu/                            # MuMu æ¨¡æ‹Ÿå™¨æ§åˆ¶ï¼ˆè®¾å¤‡ç”Ÿæˆç”¨ï¼‰
â”œâ”€â”€ api/
â”œâ”€â”€ config.py
â”œâ”€â”€ constant.py
â”œâ”€â”€ control.py
â”œâ”€â”€ mumu.py
â””â”€â”€ utils.py
SunnyNet/                        # SunnyNet æŠ“åŒ…æœåŠ¡ï¼ˆè®¾å¤‡ç”Ÿæˆç”¨ï¼‰
â”œâ”€â”€ __init__.py
â”œâ”€â”€ CertManager.py
â”œâ”€â”€ Event.py
â”œâ”€â”€ HTTPClient.py
â”œâ”€â”€ Queue.py
â”œâ”€â”€ SunnyDLL.py
â”œâ”€â”€ SunnyNet.py
â”œâ”€â”€ TCPTools.py
â”œâ”€â”€ tools.py
â”œâ”€â”€ UDPTools.py
â””â”€â”€ WebsocketTools.py
Sunny.py                         # SunnyNet å°è£…ï¼ˆè®¾å¤‡ç”Ÿæˆç”¨ï¼‰
source/                          # è®¾å¤‡ç”Ÿæˆç›¸å…³èµ„æº
â”œâ”€â”€ button.png                   # æŒ‰é’®å›¾ç‰‡ï¼ˆå¦‚æœUIä¸ç”¨å¯ä»¥åˆ é™¤ï¼‰
â””â”€â”€ tm13.12.2.apk               # å¤©çŒ« APKï¼ˆè®¾å¤‡ç”Ÿæˆç”¨ï¼‰
```

### å…¶ä»–å·¥å…·æ–‡ä»¶

```
main.py                          # å…¶ä»–å…¥å£æ–‡ä»¶
ui.py                            # å…¶ä»– UI æ–‡ä»¶
task_batch.py                    # æ‰¹å¤„ç†ä»»åŠ¡ï¼ˆå¦‚æœä¸ç”¨ï¼‰
taobao.py                        # ï¼ˆæ³¨æ„ï¼šè¿™ä¸ªéœ€è¦ä¿ç•™ï¼Œto_requests ä¾èµ–ï¼‰
```

### æ–‡æ¡£æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

```
*.md                             # æ–‡æ¡£æ–‡ä»¶ï¼ˆå¯é€‰æ‰“åŒ…ï¼‰
CLAUDE.md
README.md
å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md
å¤šå®¢æˆ·ç«¯éƒ¨ç½²è¯´æ˜.md
```

### æ‰¹å¤„ç†è„šæœ¬ï¼ˆWindowsï¼‰

```
å¯åŠ¨_åˆ·é‡å®¢æˆ·ç«¯.bat              # å¯åŠ¨è„šæœ¬ï¼ˆå¯é€‰ï¼Œç”¨äºæ‰“åŒ…åï¼‰
å¯åŠ¨_è®¾å¤‡ç”Ÿæˆ.bat                # è®¾å¤‡ç”Ÿæˆå·¥å…·è„šæœ¬ï¼ˆä¸éœ€è¦ï¼‰
å®‰è£…ä¼˜åŒ–ä¾èµ–.bat                 # ä¾èµ–å®‰è£…è„šæœ¬ï¼ˆä¸éœ€è¦ï¼‰
æ¸…ç©ºè®¾å¤‡å†·å´è®°å½•.bat             # å·¥å…·è„šæœ¬ï¼ˆä¸éœ€è¦ï¼‰
```

### ä¸´æ—¶/ç¼“å­˜æ–‡ä»¶

```
__pycache__/                     # Python ç¼“å­˜ï¼ˆä¸éœ€è¦ï¼‰
*.pyc                            # ç¼–è¯‘æ–‡ä»¶ï¼ˆä¸éœ€è¦ï¼‰
logs/                            # æ—¥å¿—ï¼ˆè¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰
client_config.json               # é…ç½®æ–‡ä»¶ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
```

---

## ğŸ“¦ æ‰“åŒ…æµç¨‹

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PyInstallerï¼ˆæ¨èï¼‰

#### 1. åˆ›å»ºæ‰“åŒ…è„šæœ¬

åˆ›å»º `build_client.spec` æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œæ›´çµæ´»ï¼‰ï¼š

```python
# -*- mode: python ; coding: utf-8 -*-

block_cipher = None

a = Analysis(
    ['ui_client.py'],
    pathex=[],
    binaries=[],
    datas=[
        # å¦‚æœæœ‰èµ„æºæ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæ·»åŠ 
        # ('source/button.png', 'source'),
    ],
    hiddenimports=[
        'PyQt5',
        'qfluentwidgets',
        'requests',
        'psutil',
        'loguru',
        'to_requests',
        'database',
        'tools',
        'model.user',
        'model.device',
        'taobao',
        'proxy_manager',
    ],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=[
        'generate_device',
        'mumu',
        'SunnyNet',
        'api_server',
        'import_data_to_db',
    ],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False,
)

pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)

exe = EXE(
    pyz,
    a.scripts,
    a.binaries,
    a.zipfiles,
    a.datas,
    [],
    name='æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    upx_exclude=[],
    runtime_tmpdir=None,
    console=False,  # ä¸æ˜¾ç¤ºæ§åˆ¶å°çª—å£
    disable_windowed_traceback=False,
    argv_emulation=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
    icon=None,  # å¦‚æœæœ‰å›¾æ ‡æ–‡ä»¶ï¼Œåœ¨è¿™é‡ŒæŒ‡å®šè·¯å¾„
)
```

#### 2. æ‰§è¡Œæ‰“åŒ…å‘½ä»¤

**Windows:**

```bash
# ä½¿ç”¨ spec æ–‡ä»¶æ‰“åŒ…
pyinstaller build_client.spec

# æˆ–ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œæ‰“åŒ…
pyinstaller --name="æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯" \
    --onefile \
    --windowed \
    --add-data "model;model" \
    --hidden-import PyQt5 \
    --hidden-import qfluentwidgets \
    --hidden-import to_requests \
    --hidden-import database \
    --hidden-import tools \
    --hidden-import model.user \
    --hidden-import model.device \
    --hidden-import taobao \
    --hidden-import proxy_manager \
    --exclude-module generate_device \
    --exclude-module mumu \
    --exclude-module SunnyNet \
    --exclude-module api_server \
    --exclude-module import_data_to_db \
    --icon=icon.ico \
    ui_client.py
```

**macOS/Linux:**

```bash
# ä½¿ç”¨ spec æ–‡ä»¶æ‰“åŒ…
pyinstaller build_client.spec

# æˆ–ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œæ‰“åŒ…
pyinstaller --name="æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯" \
    --onefile \
    --windowed \
    --add-data "model:model" \
    --hidden-import PyQt5 \
    --hidden-import qfluentwidgets \
    --hidden-import to_requests \
    --hidden-import database \
    --hidden-import tools \
    --hidden-import model.user \
    --hidden-import model.device \
    --hidden-import taobao \
    --hidden-import proxy_manager \
    --exclude-module generate_device \
    --exclude-module mumu \
    --exclude-module SunnyNet \
    --exclude-module api_server \
    --exclude-module import_data_to_db \
    --icon=icon.icns \
    ui_client.py
```

#### 3. æ‰“åŒ…è¾“å‡º

æ‰“åŒ…å®Œæˆåï¼Œå¯æ‰§è¡Œæ–‡ä»¶ä½äºï¼š

- **Windows**: `dist/æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯.exe`
- **macOS**: `dist/æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯`ï¼ˆéœ€è¦æ·»åŠ æ‰§è¡Œæƒé™ï¼‰
- **Linux**: `dist/æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯`ï¼ˆéœ€è¦æ·»åŠ æ‰§è¡Œæƒé™ï¼‰

---

### æ–¹æ³•äºŒï¼šä½¿ç”¨ cx_Freezeï¼ˆå¤‡é€‰ï¼‰

å¦‚æœ PyInstaller æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ cx_Freezeï¼š

```python
# setup.py
from cx_Freeze import setup, Executable

setup(
    name="æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯",
    version="1.0",
    description="æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯",
    executables=[Executable("ui_client.py", base="Win32GUI")],
    options={
        "build_exe": {
            "packages": [
                "PyQt5",
                "qfluentwidgets",
                "requests",
                "loguru",
            ],
            "includes": [
                "to_requests",
                "database",
                "tools",
                "model.user",
                "model.device",
                "taobao",
                "proxy_manager",
            ],
            "excludes": [
                "generate_device",
                "mumu",
                "SunnyNet",
                "api_server",
            ],
        }
    }
)
```

```bash
python setup.py build
```

---

## ğŸ“ æ‰“åŒ…åç›®å½•ç»“æ„

### å•æ–‡ä»¶æ¨¡å¼ï¼ˆ--onefileï¼‰

```
dist/
â””â”€â”€ æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯.exe    # å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆWindowsï¼‰
    # æˆ–
    â””â”€â”€ æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯      # å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆmacOS/Linuxï¼‰
```

**ä¼˜ç‚¹ï¼š** åªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–¹ä¾¿åˆ†å‘  
**ç¼ºç‚¹ï¼š** å¯åŠ¨ç¨æ…¢ï¼ˆéœ€è¦è§£å‹ä¸´æ—¶æ–‡ä»¶ï¼‰

### æ–‡ä»¶å¤¹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

```
dist/
â””â”€â”€ æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯/
    â”œâ”€â”€ æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯.exe  # ä¸»ç¨‹åº
    â”œâ”€â”€ _internal/              # ä¾èµ–åº“å’Œæ¨¡å—
    â”‚   â”œâ”€â”€ python*.dll
    â”‚   â”œâ”€â”€ PyQt5/
    â”‚   â”œâ”€â”€ qfluentwidgets/
    â”‚   â”œâ”€â”€ to_requests.py
    â”‚   â”œâ”€â”€ database.py
    â”‚   â”œâ”€â”€ tools.py
    â”‚   â”œâ”€â”€ model/
    â”‚   â””â”€â”€ ...
    â””â”€â”€ ...
```

**ä¼˜ç‚¹ï¼š** å¯åŠ¨å¿«ï¼Œä¾¿äºè°ƒè¯•  
**ç¼ºç‚¹ï¼š** æ–‡ä»¶è¾ƒå¤šï¼Œéœ€è¦æ•´ä½“åˆ†å‘

---

## âš ï¸ å¸¸è§é—®é¢˜è§£å†³

### Windows DLL åŠ è½½å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**

```
ImportError: DLL load failed while importing QtWidgets: æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡å—ã€‚
```

**è§£å†³æ–¹æ¡ˆï¼š**

#### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ onedir æ¨¡å¼ï¼ˆæ¨èï¼‰

ä½¿ç”¨ `build_client_onedir.bat` è„šæœ¬ï¼Œå®ƒä¼šåˆ›å»ºæ–‡ä»¶å¤¹æ¨¡å¼çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š

```bash
build_client_onedir.bat
```

**ä¼˜ç‚¹ï¼š**

- æ‰€æœ‰ DLL æ–‡ä»¶éƒ½åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œä¸ä¼šä¸¢å¤±
- å¯åŠ¨é€Ÿåº¦æ›´å¿«
- æ›´å®¹æ˜“è°ƒè¯•é—®é¢˜

**ç¼ºç‚¹ï¼š**

- éœ€è¦åˆ†å‘æ•´ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸èƒ½åªå¤åˆ¶ exe æ–‡ä»¶

#### æ–¹æ¡ˆ 2ï¼šå‡çº§ PyInstaller å’Œä¾èµ–

```bash
# å‡çº§ PyInstaller
pip install --upgrade pyinstaller

# é‡æ–°å®‰è£… PyQt5
pip uninstall PyQt5
pip install PyQt5==5.15.9
```

#### æ–¹æ¡ˆ 3ï¼šæ£€æŸ¥ Windows Visual C++ è¿è¡Œæ—¶

ç¡®ä¿å®‰è£…äº† **Microsoft Visual C++ Redistributable**ï¼š

- [Visual C++ 2015-2022 Redistributable (x64)](https://aka.ms/vs/17/release/vc_redist.x64.exe)

#### æ–¹æ¡ˆ 4ï¼šæ‰‹åŠ¨æ·»åŠ  DLL è·¯å¾„

å¦‚æœä½¿ç”¨ `--onefile` æ¨¡å¼ä»ç„¶å¤±è´¥ï¼Œå¯ä»¥å°è¯•ï¼š

1. æ‰¾åˆ° PyQt5 å®‰è£…ç›®å½•ï¼ˆé€šå¸¸åœ¨ `Python\Lib\site-packages\PyQt5\Qt5\bin\`ï¼‰
2. å°† DLL æ–‡ä»¶å¤åˆ¶åˆ° exe æ–‡ä»¶æ‰€åœ¨ç›®å½•
3. æˆ–å°† DLL è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿ PATH

### å…¶ä»–å¸¸è§é—®é¢˜

**é—®é¢˜ï¼šæ‰“åŒ…åæ–‡ä»¶å¤ªå¤§**

- ä½¿ç”¨ `--exclude-module` æ’é™¤ä¸éœ€è¦çš„æ¨¡å—
- æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„ä¾èµ–

**é—®é¢˜ï¼šå¯åŠ¨é€Ÿåº¦æ…¢**

- ä½¿ç”¨ `--onedir` æ¨¡å¼è€Œä¸æ˜¯ `--onefile`
- `--onefile` æ¨¡å¼æ¯æ¬¡å¯åŠ¨éœ€è¦è§£å‹ä¸´æ—¶æ–‡ä»¶

**é—®é¢˜ï¼šç¼ºå°‘æ¨¡å—é”™è¯¯**

- æ£€æŸ¥ `--hidden-import` å‚æ•°æ˜¯å¦åŒ…å«äº†æ‰€æœ‰éœ€è¦çš„æ¨¡å—
- ä½¿ç”¨ `--collect-all` æ”¶é›†æ•´ä¸ªåŒ…çš„èµ„æº

---

## ğŸš€ æµ‹è¯•ä¸åˆ†å‘

### 1. æµ‹è¯•æ¸…å•

æ‰“åŒ…å®Œæˆåï¼Œåœ¨**å¹²å‡€çš„æµ‹è¯•ç¯å¢ƒ**ä¸­æµ‹è¯•ï¼š

- [ ] ç¨‹åºèƒ½æ­£å¸¸å¯åŠ¨
- [ ] UI ç•Œé¢æ­£å¸¸æ˜¾ç¤º
- [ ] Cookie å¯¼å…¥/æ‹‰å–åŠŸèƒ½æ­£å¸¸
- [ ] è®¾å¤‡å¯¼å…¥/æ‹‰å–åŠŸèƒ½æ­£å¸¸
- [ ] åˆ·é‡ä»»åŠ¡èƒ½æ­£å¸¸æ‰§è¡Œ
- [ ] æ—¥å¿—æ–‡ä»¶èƒ½æ­£å¸¸ç”Ÿæˆï¼ˆ`logs/` ç›®å½•ï¼‰
- [ ] é…ç½®æ–‡ä»¶èƒ½æ­£å¸¸ä¿å­˜ï¼ˆ`client_config.json`ï¼‰

### 2. åˆ†å‘æ–‡ä»¶

#### å•æ–‡ä»¶æ¨¡å¼ï¼š

```
ğŸ“¦ æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯_v1.0/
â”œâ”€â”€ æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯.exe    # ä¸»ç¨‹åº
â”œâ”€â”€ README.txt                 # ä½¿ç”¨è¯´æ˜
â””â”€â”€ å¯åŠ¨è¯´æ˜.txt               # å¯åŠ¨æŒ‡å—ï¼ˆå¯é€‰ï¼‰
```

#### æ–‡ä»¶å¤¹æ¨¡å¼ï¼š

```
ğŸ“¦ æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯_v1.0/
â”œâ”€â”€ æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯/        # å®Œæ•´ç¨‹åºç›®å½•
â”‚   â”œâ”€â”€ æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯.exe
â”‚   â””â”€â”€ _internal/
â”œâ”€â”€ README.txt                 # ä½¿ç”¨è¯´æ˜
â””â”€â”€ å¯åŠ¨è¯´æ˜.txt               # å¯åŠ¨æŒ‡å—ï¼ˆå¯é€‰ï¼‰
```

### 3. ä½¿ç”¨è¯´æ˜æ¨¡æ¿ï¼ˆREADME.txtï¼‰

```
========================================
æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯ v1.0
========================================

ã€ç³»ç»Ÿè¦æ±‚ã€‘
- Windows 7/10/11 (64ä½)
- æˆ– macOS 10.14+
- æˆ– Linux (Ubuntu 18.04+)

ã€å¯åŠ¨æ–¹æ³•ã€‘
1. åŒå‡»è¿è¡Œ "æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯.exe"ï¼ˆWindowsï¼‰
  æˆ– "æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯"ï¼ˆmacOS/Linuxï¼‰

2. é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶

ã€åŠŸèƒ½è¯´æ˜ã€‘
- æ”¯æŒä»æœåŠ¡å™¨æ‹‰å– Cookie å’Œè®¾å¤‡å‚æ•°
- æ”¯æŒæ‰‹åŠ¨å¯¼å…¥ Cookie å’Œè®¾å¤‡å‚æ•°
- æ”¯æŒåˆ·é‡ä»»åŠ¡æ‰§è¡Œå’Œç›‘æ§
- è‡ªåŠ¨è®°å½•æ—¥å¿—åˆ° logs/ ç›®å½•

ã€é…ç½®æ–‡ä»¶ã€‘
- client_config.jsonï¼šå®¢æˆ·ç«¯é…ç½®ï¼ˆAPIåœ°å€ã€å¯†é’¥ç­‰ï¼‰
- task_timestamps.jsonï¼šä»»åŠ¡æ—¶é—´æˆ³ç¼“å­˜
- used_devices.jsonï¼šå·²ä½¿ç”¨è®¾å¤‡è®°å½•

ã€æ—¥å¿—æ–‡ä»¶ã€‘
- logs/ui_client_YYYY-MM-DD.logï¼šæ™®é€šæ—¥å¿—
- logs/error_YYYY-MM-DD.logï¼šé”™è¯¯æ—¥å¿—

ã€æ³¨æ„äº‹é¡¹ã€‘
- é¦–æ¬¡ä½¿ç”¨éœ€è¦é…ç½® API åœ°å€å’Œå®¢æˆ·ç«¯å¯†é’¥
- ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼ˆç”¨äºæ‹‰å–èµ„æºå’Œæ‰§è¡Œä»»åŠ¡ï¼‰
- æ—¥å¿—æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»º logs ç›®å½•

ã€æ•…éšœæ’é™¤ã€‘
å¦‚æœç¨‹åºæ— æ³•å¯åŠ¨ï¼š
1. æ£€æŸ¥æ˜¯å¦æœ‰æ€æ¯’è½¯ä»¶æ‹¦æˆª
2. æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æœ‰å¿…è¦çš„è¿è¡Œåº“
3. æŸ¥çœ‹ logs/error_*.log æ—¥å¿—æ–‡ä»¶

========================================
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. éšè—å¯¼å…¥æ¨¡å—

PyInstaller å¯èƒ½æ— æ³•è‡ªåŠ¨æ£€æµ‹åˆ°ä»¥ä¸‹æ¨¡å—ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼š

- `model.user`
- `model.device`
- `to_requests`
- `database`
- `tools`
- `taobao`
- `proxy_manager`

### 2. æ’é™¤ä¸éœ€è¦çš„æ¨¡å—

ä»¥ä¸‹æ¨¡å—ä¼šæ˜¾è‘—å¢åŠ æ‰“åŒ…ä½“ç§¯ï¼Œå¿…é¡»æ’é™¤ï¼š

- `generate_device`
- `mumu`
- `SunnyNet`
- `api_server`
- `import_data_to_db`

### 3. æ—¥å¿—ç›®å½•

ç¨‹åºè¿è¡Œæ—¶ä¼šåœ¨**å½“å‰å·¥ä½œç›®å½•**åˆ›å»º `logs/` ç›®å½•ï¼Œç¡®ä¿ç¨‹åºæœ‰å†™å…¥æƒé™ã€‚

### 4. é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ä¼šåœ¨**ç¨‹åºæ‰€åœ¨ç›®å½•**åˆ›å»ºï¼š

- `client_config.json`
- `task_timestamps.json`
- `used_devices.json`

### 5. å›¾æ ‡æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦è‡ªå®šä¹‰å›¾æ ‡ï¼š

- **Windows**: `icon.ico`ï¼ˆ256x256 åƒç´ ï¼‰
- **macOS**: `icon.icns`
- **Linux**: `icon.png`ï¼ˆ512x512 åƒç´ ï¼‰

### 6. é˜²ç—…æ¯’è½¯ä»¶

æŸäº›æ€æ¯’è½¯ä»¶å¯èƒ½ä¼šè¯¯æŠ¥æ‰“åŒ…åçš„ç¨‹åºï¼Œå»ºè®®ï¼š

- æ‰“åŒ…å‰åœ¨æ‰“åŒ…æœºå™¨ä¸Šæ·»åŠ ç™½åå•
- æˆ–ä½¿ç”¨ä»£ç ç­¾åè¯ä¹¦ï¼ˆéœ€è¦è´­ä¹°ï¼‰

---

## ğŸ“ å¿«é€Ÿæ‰“åŒ…å‘½ä»¤ï¼ˆWindowsï¼‰

åˆ›å»ºä¸€ä¸ª `build.bat` æ–‡ä»¶ï¼š

```batch
@echo off
echo ========================================
echo æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯ - æ‰“åŒ…è„šæœ¬
echo ========================================
echo.

echo [1/3] æ¸…ç†æ—§çš„æ‰“åŒ…æ–‡ä»¶...
if exist build rmdir /s /q build
if exist dist rmdir /s /q dist
if exist "æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯.spec" del "æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯.spec"
echo æ¸…ç†å®Œæˆï¼
echo.

echo [2/3] å¼€å§‹æ‰“åŒ…...
pyinstaller --name="æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯" ^
    --onefile ^
    --windowed ^
    --add-data "model;model" ^
    --hidden-import to_requests ^
    --hidden-import database ^
    --hidden-import tools ^
    --hidden-import model.user ^
    --hidden-import model.device ^
    --hidden-import taobao ^
    --hidden-import proxy_manager ^
    --exclude-module generate_device ^
    --exclude-module mumu ^
    --exclude-module SunnyNet ^
    --exclude-module api_server ^
    --exclude-module import_data_to_db ^
    ui_client.py

if %errorlevel% neq 0 (
    echo.
    echo âŒ æ‰“åŒ…å¤±è´¥ï¼è¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯ã€‚
    pause
    exit /b 1
)

echo.
echo [3/3] æ‰“åŒ…å®Œæˆï¼
echo.
echo å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®: dist\æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯.exe
echo.
pause
```

---

## ğŸ“ å¿«é€Ÿæ‰“åŒ…å‘½ä»¤ï¼ˆmacOS/Linuxï¼‰

åˆ›å»ºä¸€ä¸ª `build.sh` æ–‡ä»¶ï¼š

```bash
#!/bin/bash

echo "========================================"
echo "æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯ - æ‰“åŒ…è„šæœ¬"
echo "========================================"
echo

echo "[1/3] æ¸…ç†æ—§çš„æ‰“åŒ…æ–‡ä»¶..."
rm -rf build dist *.spec
echo "æ¸…ç†å®Œæˆï¼"
echo

echo "[2/3] å¼€å§‹æ‰“åŒ…..."
pyinstaller --name="æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯" \
    --onefile \
    --windowed \
    --add-data "model:model" \
    --hidden-import to_requests \
    --hidden-import database \
    --hidden-import tools \
    --hidden-import model.user \
    --hidden-import model.device \
    --hidden-import taobao \
    --hidden-import proxy_manager \
    --exclude-module generate_device \
    --exclude-module mumu \
    --exclude-module SunnyNet \
    --exclude-module api_server \
    --exclude-module import_data_to_db \
    ui_client.py

if [ $? -ne 0 ]; then
    echo
    echo "âŒ æ‰“åŒ…å¤±è´¥ï¼è¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯ã€‚"
    exit 1
fi

echo
echo "[3/3] æ‰“åŒ…å®Œæˆï¼"
echo
echo "å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®: dist/æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯"
echo
chmod +x dist/æ·˜å®ç›´æ’­åˆ·é‡å®¢æˆ·ç«¯
```

---

## ğŸ” æ‰“åŒ…é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: ModuleNotFoundError

**åŸå› ï¼š** PyInstaller æ²¡æœ‰æ£€æµ‹åˆ°æŸäº›æ¨¡å—

**è§£å†³ï¼š** åœ¨æ‰“åŒ…å‘½ä»¤ä¸­æ·»åŠ  `--hidden-import æ¨¡å—å`

### é—®é¢˜ 2: ç¨‹åºå¯åŠ¨åç«‹å³é€€å‡º

**åŸå› ï¼š** ç¼ºå°‘å¿…è¦çš„ä¾èµ–æˆ–é…ç½®æ–‡ä»¶

**è§£å†³ï¼š**

- æ£€æŸ¥ `--hidden-import` æ˜¯å¦å®Œæ•´
- æ£€æŸ¥ `model/` ç›®å½•æ˜¯å¦åŒ…å«åœ¨æ‰“åŒ…ä¸­
- ä½¿ç”¨ `--console` æ¨¡å¼æ‰“åŒ…ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 3: UI ç•Œé¢æ˜¾ç¤ºå¼‚å¸¸

**åŸå› ï¼š** PyQt5 æˆ– qfluentwidgets çš„èµ„æºæ–‡ä»¶æœªæ­£ç¡®æ‰“åŒ…

**è§£å†³ï¼š**

- ä½¿ç”¨æ–‡ä»¶å¤¹æ¨¡å¼æ‰“åŒ…ï¼ˆä¸ä½¿ç”¨ `--onefile`ï¼‰
- æ£€æŸ¥æ˜¯å¦æœ‰å›¾æ ‡æˆ–èµ„æºæ–‡ä»¶éœ€è¦æ‰‹åŠ¨æ·»åŠ 

### é—®é¢˜ 4: æ‰“åŒ…ä½“ç§¯è¿‡å¤§

**åŸå› ï¼š** åŒ…å«äº†ä¸éœ€è¦çš„æ¨¡å—æˆ–åº“

**è§£å†³ï¼š**

- ä½¿ç”¨ `--exclude-module` æ’é™¤ä¸éœ€è¦çš„æ¨¡å—
- æ£€æŸ¥æ˜¯å¦æœ‰å¤§å‹ä¾èµ–åº“ï¼ˆå¦‚ opencv-pythonï¼‰è¢«åŒ…å«

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š

- æ—¥å¿—æ–‡ä»¶ï¼š`logs/error_*.log`
- æ‰“åŒ…æ—¥å¿—ï¼š`build/*.log`

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025-11-03
